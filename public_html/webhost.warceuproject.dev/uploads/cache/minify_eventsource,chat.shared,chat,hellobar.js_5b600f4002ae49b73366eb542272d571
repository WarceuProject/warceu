(function(global){"use strict";var setTimeout=global.setTimeout;var clearTimeout=global.clearTimeout;var k=function(){};function XHRTransport(xhr,onStartCallback,onProgressCallback,onFinishCallback,thisArg){this._internal=new XHRTransportInternal(xhr,onStartCallback,onProgressCallback,onFinishCallback,thisArg);}
XHRTransport.prototype.open=function(url,withCredentials){this._internal.open(url,withCredentials);};XHRTransport.prototype.cancel=function(){this._internal.cancel();};function XHRTransportInternal(xhr,onStartCallback,onProgressCallback,onFinishCallback,thisArg){this.onStartCallback=onStartCallback;this.onProgressCallback=onProgressCallback;this.onFinishCallback=onFinishCallback;this.thisArg=thisArg;this.xhr=xhr;this.state=0;this.charOffset=0;this.offset=0;this.url="";this.withCredentials=false;this.timeout=0;}
XHRTransportInternal.prototype.onStart=function(){if(this.state===1){this.state=2;var status=0;var statusText="";var contentType=undefined;if(!("contentType"in this.xhr)){try{status=this.xhr.status;statusText=this.xhr.statusText;contentType=this.xhr.getResponseHeader("Content-Type");}catch(error){status=0;statusText="";contentType=undefined;}}else{status=200;statusText="OK";contentType=this.xhr.contentType;}
if(contentType==undefined){contentType="";}
this.onStartCallback.call(this.thisArg,status,statusText,contentType);}};XHRTransportInternal.prototype.onProgress=function(){this.onStart();if(this.state===2||this.state===3){this.state=3;var responseText="";try{responseText=this.xhr.responseText;}catch(error){}
var chunkStart=this.charOffset;var length=responseText.length;for(var i=this.offset;i<length;i+=1){var c=responseText.charCodeAt(i);if(c==="\n".charCodeAt(0)||c==="\r".charCodeAt(0)){this.charOffset=i+1;}}
this.offset=length;var chunk=responseText.slice(chunkStart,this.charOffset);this.onProgressCallback.call(this.thisArg,chunk);}};XHRTransportInternal.prototype.onFinish=function(){this.onProgress();if(this.state===3){this.state=4;if(this.timeout!==0){clearTimeout(this.timeout);this.timeout=0;}
this.onFinishCallback.call(this.thisArg);}};XHRTransportInternal.prototype.onReadyStateChange=function(){if(this.xhr!=undefined){if(this.xhr.readyState===4){if(this.xhr.status===0){this.onFinish();}else{this.onFinish();}}else if(this.xhr.readyState===3){this.onProgress();}else if(this.xhr.readyState===2){}}};XHRTransportInternal.prototype.onTimeout2=function(){this.timeout=0;var tmp=(/^data\:([^,]*?)(base64)?,([\S]*)$/).exec(this.url);var contentType=tmp[1];var data=tmp[2]==="base64"?global.atob(tmp[3]):decodeURIComponent(tmp[3]);if(this.state===1){this.state=2;this.onStartCallback.call(this.thisArg,200,"OK",contentType);}
if(this.state===2||this.state===3){this.state=3;this.onProgressCallback.call(this.thisArg,data);}
if(this.state===3){this.state=4;this.onFinishCallback.call(this.thisArg);}};XHRTransportInternal.prototype.onTimeout1=function(){this.timeout=0;this.open(this.url,this.withCredentials);};XHRTransportInternal.prototype.onTimeout0=function(){var that=this;this.timeout=setTimeout(function(){that.onTimeout0();},500);if(this.xhr.readyState===3){this.onProgress();}};XHRTransportInternal.prototype.handleEvent=function(event){if(event.type==="load"){this.onFinish();}else if(event.type==="error"){this.onFinish();}else if(event.type==="abort"){this.onFinish();}else if(event.type==="progress"){this.onProgress();}else if(event.type==="readystatechange"){this.onReadyStateChange();}};XHRTransportInternal.prototype.open=function(url,withCredentials){if(this.timeout!==0){clearTimeout(this.timeout);this.timeout=0;}
this.url=url;this.withCredentials=withCredentials;this.state=1;this.charOffset=0;this.offset=0;var that=this;var tmp=(/^data\:([^,]*?)(?:;base64)?,[\S]*$/).exec(url);if(tmp!=undefined){this.timeout=setTimeout(function(){that.onTimeout2();},0);return;}
if((!("ontimeout"in this.xhr)||("sendAsBinary"in this.xhr)||("mozAnon"in this.xhr))&&global.document!=undefined&&global.document.readyState!=undefined&&global.document.readyState!=="complete"){this.timeout=setTimeout(function(){that.onTimeout1();},4);return;}
this.xhr.onload=function(event){that.handleEvent({type:"load"});};this.xhr.onerror=function(){that.handleEvent({type:"error"});};this.xhr.onabort=function(){that.handleEvent({type:"abort"});};this.xhr.onprogress=function(){that.handleEvent({type:"progress"});};this.xhr.onreadystatechange=function(){that.handleEvent({type:"readystatechange"});};this.xhr.open("GET",url,true);this.xhr.withCredentials=withCredentials;this.xhr.responseType="text";if("setRequestHeader"in this.xhr){this.xhr.setRequestHeader("Accept","text/event-stream");}
try{this.xhr.send(undefined);}catch(error1){throw error1;}
if(("readyState"in this.xhr)&&global.opera!=undefined){this.timeout=setTimeout(function(){that.onTimeout0();},0);}};XHRTransportInternal.prototype.cancel=function(){if(this.state!==0&&this.state!==4){this.state=4;this.xhr.onload=k;this.xhr.onerror=k;this.xhr.onabort=k;this.xhr.onprogress=k;this.xhr.onreadystatechange=k;this.xhr.abort();if(this.timeout!==0){clearTimeout(this.timeout);this.timeout=0;}
this.onFinishCallback.call(this.thisArg);}
this.state=0;};function Map(){this._data={};}
Map.prototype.get=function(key){return this._data[key+"~"];};Map.prototype.set=function(key,value){this._data[key+"~"]=value;};Map.prototype["delete"]=function(key){delete this._data[key+"~"];};function EventTarget(){this._listeners=new Map();}
function throwError(e){setTimeout(function(){throw e;},0);}
EventTarget.prototype.dispatchEvent=function(event){event.target=this;var type=event.type.toString();var listeners=this._listeners;var typeListeners=listeners.get(type);if(typeListeners==undefined){return;}
var length=typeListeners.length;var listener=undefined;for(var i=0;i<length;i+=1){listener=typeListeners[i];try{if(typeof listener.handleEvent==="function"){listener.handleEvent(event);}else{listener.call(this,event);}}catch(e){throwError(e);}}};EventTarget.prototype.addEventListener=function(type,callback){type=type.toString();var listeners=this._listeners;var typeListeners=listeners.get(type);if(typeListeners==undefined){typeListeners=[];listeners.set(type,typeListeners);}
for(var i=typeListeners.length;i>=0;i-=1){if(typeListeners[i]===callback){return;}}
typeListeners.push(callback);};EventTarget.prototype.removeEventListener=function(type,callback){type=type.toString();var listeners=this._listeners;var typeListeners=listeners.get(type);if(typeListeners==undefined){return;}
var length=typeListeners.length;var filtered=[];for(var i=0;i<length;i+=1){if(typeListeners[i]!==callback){filtered.push(typeListeners[i]);}}
if(filtered.length===0){listeners["delete"](type);}else{listeners.set(type,filtered);}};function Event(type){this.type=type;this.target=undefined;}
function MessageEvent(type,options){Event.call(this,type);this.data=options.data;this.lastEventId=options.lastEventId;}
MessageEvent.prototype=Event.prototype;var XHR=global.XMLHttpRequest;var XDR=global.XDomainRequest;var isCORSSupported=XHR!=undefined&&(new XHR()).withCredentials!=undefined;var Transport=isCORSSupported||(XHR!=undefined&&XDR==undefined)?XHR:XDR;var WAITING=-1;var CONNECTING=0;var OPEN=1;var CLOSED=2;var AFTER_CR=3;var FIELD_START=4;var FIELD=5;var VALUE_START=6;var VALUE=7;var contentTypeRegExp=/^text\/event\-stream;?(\s*charset\=utf\-8)?$/i;var MINIMUM_DURATION=1000;var MAXIMUM_DURATION=18000000;var getDuration=function(value,def){var n=value;if(n!==n){n=def;}
return(n<MINIMUM_DURATION?MINIMUM_DURATION:(n>MAXIMUM_DURATION?MAXIMUM_DURATION:n));};var fire=function(that,f,event){try{if(typeof f==="function"){f.call(that,event);}}catch(e){throwError(e);}};function EventSource(url,options){EventTarget.call(this);this.onopen=undefined;this.onmessage=undefined;this.onerror=undefined;this.url="";this.readyState=CONNECTING;this.withCredentials=false;this._internal=new EventSourceInternal(this,url,options);}
function EventSourceInternal(es,url,options){this.url=url.toString();this.readyState=CONNECTING;this.withCredentials=isCORSSupported&&options!=undefined&&Boolean(options.withCredentials);this.es=es;this.initialRetry=getDuration(1000,0);this.heartbeatTimeout=getDuration(45000,0);this.lastEventId="";this.retry=this.initialRetry;this.wasActivity=false;var CurrentTransport=options!=undefined&&options.Transport!=undefined?options.Transport:Transport;var xhr=new CurrentTransport();this.transport=new XHRTransport(xhr,this.onStart,this.onProgress,this.onFinish,this);this.timeout=0;this.currentState=WAITING;this.dataBuffer=[];this.lastEventIdBuffer="";this.eventTypeBuffer="";this.state=FIELD_START;this.fieldStart=0;this.valueStart=0;this.es.url=this.url;this.es.readyState=this.readyState;this.es.withCredentials=this.withCredentials;this.onTimeout();}
EventSourceInternal.prototype.onStart=function(status,statusText,contentType){if(this.currentState===CONNECTING){if(contentType==undefined){contentType="";}
if(status===200&&contentTypeRegExp.test(contentType)){this.currentState=OPEN;this.wasActivity=true;this.retry=this.initialRetry;this.readyState=OPEN;this.es.readyState=OPEN;var event=new Event("open");this.es.dispatchEvent(event);fire(this.es,this.es.onopen,event);}else if(status!==0){var message="";if(status!==200){message="EventSource's response has a status "+status+" "+statusText.replace(/\s+/g," ")+" that is not 200. Aborting the connection.";}else{message="EventSource's response has a Content-Type specifying an unsupported type: "+contentType.replace(/\s+/g," ")+". Aborting the connection.";}
throwError(new Error(message));this.close();var event=new Event("error");this.es.dispatchEvent(event);fire(this.es,this.es.onerror,event);}}};EventSourceInternal.prototype.onProgress=function(chunk){if(this.currentState===OPEN){var length=chunk.length;if(length!==0){this.wasActivity=true;}
for(var position=0;position<length;position+=1){var c=chunk.charCodeAt(position);if(this.state===AFTER_CR&&c==="\n".charCodeAt(0)){this.state=FIELD_START;}else{if(this.state===AFTER_CR){this.state=FIELD_START;}
if(c==="\r".charCodeAt(0)||c==="\n".charCodeAt(0)){if(this.state!==FIELD_START){if(this.state===FIELD){this.valueStart=position+1;}
var field=chunk.slice(this.fieldStart,this.valueStart-1);var value=chunk.slice(this.valueStart+(this.valueStart<position&&chunk.charCodeAt(this.valueStart)===" ".charCodeAt(0)?1:0),position);if(field==="data"){this.dataBuffer.push(value);}else if(field==="id"){this.lastEventIdBuffer=value;}else if(field==="event"){this.eventTypeBuffer=value;}else if(field==="retry"){this.initialRetry=getDuration(Number(value),this.initialRetry);this.retry=this.initialRetry;}else if(field==="heartbeatTimeout"){this.heartbeatTimeout=getDuration(Number(value),this.heartbeatTimeout);if(this.timeout!==0){clearTimeout(this.timeout);var that=this;this.timeout=setTimeout(function(){that.onTimeout();},this.heartbeatTimeout);}}}
if(this.state===FIELD_START){if(this.dataBuffer.length!==0){this.lastEventId=this.lastEventIdBuffer;if(this.eventTypeBuffer===""){this.eventTypeBuffer="message";}
var event=new MessageEvent(this.eventTypeBuffer,{data:this.dataBuffer.join("\n"),lastEventId:this.lastEventIdBuffer});this.es.dispatchEvent(event);if(this.eventTypeBuffer==="message"){fire(this.es,this.es.onmessage,event);}
if(this.currentState===CLOSED){return;}}
this.dataBuffer.length=0;this.eventTypeBuffer="";}
this.state=c==="\r".charCodeAt(0)?AFTER_CR:FIELD_START;}else{if(this.state===FIELD_START){this.fieldStart=position;this.state=FIELD;}
if(this.state===FIELD){if(c===":".charCodeAt(0)){this.valueStart=position+1;this.state=VALUE_START;}}else if(this.state===VALUE_START){this.state=VALUE;}}}}}};EventSourceInternal.prototype.onFinish=function(){if(this.currentState===OPEN||this.currentState===CONNECTING){this.currentState=WAITING;if(this.timeout!==0){clearTimeout(this.timeout);this.timeout=0;}
if(this.retry>this.initialRetry*16){this.retry=this.initialRetry*16;}
if(this.retry>MAXIMUM_DURATION){this.retry=MAXIMUM_DURATION;}
var that=this;this.timeout=setTimeout(function(){that.onTimeout();},this.retry);this.retry=this.retry*2+1;this.readyState=CONNECTING;this.es.readyState=CONNECTING;var event=new Event("error");this.es.dispatchEvent(event);fire(this.es,this.es.onerror,event);}};EventSourceInternal.prototype.onTimeout=function(){this.timeout=0;if(this.currentState!==WAITING){if(!this.wasActivity){throwError(new Error("No activity within "+this.heartbeatTimeout+" milliseconds. Reconnecting."));this.transport.cancel();}else{this.wasActivity=false;var that=this;this.timeout=setTimeout(function(){that.onTimeout();},this.heartbeatTimeout);}
return;}
this.wasActivity=false;var that=this;this.timeout=setTimeout(function(){that.onTimeout();},this.heartbeatTimeout);this.currentState=CONNECTING;this.dataBuffer.length=0;this.eventTypeBuffer="";this.lastEventIdBuffer=this.lastEventId;this.fieldStart=0;this.valueStart=0;this.state=FIELD_START;var s=this.url.slice(0,5);if(s!=="data:"&&s!=="blob:"){s=this.url+((this.url.indexOf("?",0)===-1?"?":"&")+"lastEventId="+encodeURIComponent(this.lastEventId)+"&r="+(Math.random()+1).toString().slice(2));}else{s=this.url;}
try{this.transport.open(s,this.withCredentials);}catch(error){this.close();throw error;}};EventSourceInternal.prototype.close=function(){this.currentState=CLOSED;this.transport.cancel();if(this.timeout!==0){clearTimeout(this.timeout);this.timeout=0;}
this.readyState=CLOSED;this.es.readyState=CLOSED;};function F(){this.CONNECTING=CONNECTING;this.OPEN=OPEN;this.CLOSED=CLOSED;}
F.prototype=EventTarget.prototype;EventSource.prototype=new F();EventSource.prototype.close=function(){this._internal.close();};F.call(EventSource);if(isCORSSupported){EventSource.prototype.withCredentials=undefined;}
var isEventSourceSupported=function(){return global.EventSource!=undefined&&("withCredentials"in global.EventSource.prototype);};if(Transport!=undefined&&(global.EventSource==undefined||(isCORSSupported&&!isEventSourceSupported()))){global.NativeEventSource=global.EventSource;global.EventSource=EventSource;}}(typeof window!=='undefined'?window:this));;var chat=chat||{};chat.user=chat.user||{};if(typeof ce==='undefined'){ce=clientexec;}
chat.set_defaults_for_new_room=function()
{chat.timer_typing=null;chat.initialload=true;chat.lastmessageid=0;chat.previoustime=0;chat.canscroll=true;chat.users=null;};chat.startMyEventService=function(usertype)
{chat.close_event_source();chat.data=new EventSource(chat.path+'send.php?serviceid='+chat.eventserviceid+'&roomid='+chat.roomid+'&fromid='+chat.lastmessageid+'&chatterid='+chat.user.chatterid+"&usertype="+usertype);chat.data.onopen=function(e){};chat.data.onmessage=function(e){};chat.data.addEventListener(chat.roomid+'user',chat.handlerforuserevent,false);if(chat.roomispublic){chat.data.addEventListener(chat.roomid+'roomstatus',chat.publicroom_handleroomstatusupdate,false);}else{chat.data.addEventListener(chat.roomid+'roomstatus',chat.handleroomstatusupdate,false);}
chat.data.addEventListener(chat.roomid+'typing',chat.handle_typing_event,false);chat.data.addEventListener(chat.roomid+'message',chat.add_message,false);chat.data.onerror=chat.onerrorhandler;};chat.close_event_source=function()
{if(chat.data!=null){chat.data.close();chat.data.readyState=2;chat.data=null;}};chat.onerrorhandler=function(e)
{if(chat.roomispublic){chat.publicroom_check_if_user_should_be_logged_off(e);}else{chat.check_if_user_should_be_logged_off(e);}};chat.handlerforuserevent=function(e)
{chat.set_other_users_name($.parseJSON(e.data));};chat.sendimages=function(data){var msg="";var new_msg_ctrl=null;var hash;$.each(data.result.files,function(index,file){msg+="[ceimg]"+file.name+"[/ceimg]";hash=file.name;});var enoch=Math.round(new Date().getTime()/1000);window.clearTimeout(chat.timer_typing);chat.timer_typing=null;if($('#log dd').length>0){new_msg_ctrl=chat.addmessagedom({msg:msg,chatterid:chat.user.chatterid,time:enoch,gravatar:chat.user.gravatar,fullname:chat.user.fullname},true);chat.canscroll=true;chat.scrollintoview();}
$.ajax({url:"index.php?fuse=admin&controller=plugin&action=doplugin&pluginaction=savemsg&plugin=livevisitor",type:'POST',data:{id:chat.roomid,chatterid:chat.user.chatterid,message:msg,title:top.document.title,groupid:chat.groupid,hash:hash,userid:(typeof(clientexec)!="undefined"&&typeof(clientexec.admin_id)!="undefined")?clientexec.admin_id:0,user:chat.user.fullname,email:chat.user.email},success:function(response){if(new_msg_ctrl!=null)new_msg_ctrl.attr('data-msgid',response);}});};chat.sendtypedmessage=function(ctrl)
{var new_msg_ctrl=null;var enoch=Math.round(new Date().getTime()/1000);window.clearTimeout(chat.timer_typing);chat.timer_typing=null;if($.trim(ctrl.val())==="")return;msg=ctrl.val();if($('#log dd').length>0){new_msg_ctrl=chat.addmessagedom({msg:msg,chatterid:chat.user.chatterid,time:enoch,gravatar:chat.user.gravatar,fullname:chat.user.fullname},true);chat.canscroll=true;chat.scrollintoview();}
$.ajax({url:"index.php?fuse=admin&controller=plugin&action=doplugin&pluginaction=savemsg&plugin=livevisitor",type:'POST',data:{id:chat.roomid,chatterid:chat.user.chatterid,message:ctrl.val(),title:top.document.title,groupid:chat.groupid,userid:(typeof(clientexec)!="undefined"&&typeof(clientexec.admin_id)!="undefined")?clientexec.admin_id:0,user:chat.user.fullname,email:chat.user.email},success:function(response){if(new_msg_ctrl!=null)new_msg_ctrl.attr('data-msgid',response);}});ctrl.val('');};chat.close_room=function(roomid)
{if(!roomid)roomid=chat.roomid;$.ajax({url:"index.php?fuse=admin&controller=plugin&action=doplugin&pluginaction=closeroom&plugin=livevisitor",type:'POST',data:{roomid:roomid},success:$.noop});};chat.add_message=function(e)
{var amessages=$.parseJSON(e.data);amessages=amessages['data'];if(amessages.length===0)return;chat.lastmessageid=amessages[amessages.length-1].id;var msgaddednotme=false;$.each(amessages,function(index,message){if((message.chatterid!=chat.user.chatterid)||(chat.initialload)){msgaddednotme=true;new_msg_ctrl=chat.addmessagedom(message);if(new_msg_ctrl!=null)new_msg_ctrl.attr('data-msgid',message.id);}else if(message.chatterid==chat.user.chatterid){$('.msg-not-validated[data-msgid="'+message.id+'"]').removeClass('msg-not-validated')}});if(msgaddednotme&&!chat.initialload){chat.new_message_notification(amessages[0],chat.playsound);chat.remove_typing_image(amessages[0].chatterid,amessages[0].email);}
chat.scrollintoview(true);if(typeof(chat.post_sent_message)==="function"){chat.post_sent_message();}
chat.initialload=false;};chat.handlemsgtags=function(msg)
{if(msg.indexOf("[ceimg]")===-1)return msg;msg=msg.replace("[ceimg]","<ceimg>");msg=msg.replace("[/ceimg]","</ceimg>");path=$(msg).filter('ceimg').html();if(chat.groupid===0){newpath=location.href.substring(0,location.href.lastIndexOf('/')+1);newpath=newpath+chat.path+"../../../../uploads/files/"+chat.roomid+"/"+path;return"<a href='"+newpath+"' target='_blank'><img class='chat-log-image' src='"+newpath+"' style='padding-top:10px;padding-bottom:10px;max-width:265px;margin-left:-5px;' /></a>";}else{return"<a href='../uploads/files/"+chat.roomid+"/"+path+"' target='_blank'><img class='chat-log-image' src='../uploads/files/"+chat.roomid+"/"+path+"' /></a>";}};chat.replaceURLWithHTMLLinks=function(text){text=text.replace(/<a href='http/g,"<a href='ht-ttp");text=text.replace(/(\b(https?|ftp|file):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[\-A-Z0-9+&@#\/%=~_|])/img,'<a href="$1" target="_blank">$1</a>');text=text.replace(/<a href='ht-ttp/g,"<a target='_blank' href='http");return text;};chat.addmessagedom=function(message,sentbyme)
{if(message.msg===null)return null;if(typeof(sentbyme)=="undefined")sentbyme=false;var messageDate;var timediff;var months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];message.msg=message.msg.replace(/\\'/g,"'");message.msg=message.msg.replace(/\\"/g,'"');nameclass="";message.msg=ce.strip_tags(message.msg,'<a>');message.msg=chat.replaceURLWithHTMLLinks(message.msg);message.msg=chat.handlemsgtags(message.msg);message.msg=message.msg.replace(/\n/g,'<br/>');timediff=(message.time-chat.previoustime);chat.previoustime=message.time;if((message.chatterid==$('#log dl:last').attr('class'))&&(timediff<900)){new_ctrl=$('<dd>'+message.msg+'</dd>').appendTo($('#log dl:last'));}else{if(message.chatterid!==chat.user.chatterid){nameclass="nameofotheruser";}
if($('#log .scrolltome').length>0)
{ctrl=$('#skeleton').clone().insertBefore($('#log .scrolltome')).addClass(message.chatterid).removeAttr('id').find('dd').html("<strong class='nameofuser "+nameclass+"'>"+ce.htmlspecialchars(message.fullname)+"</strong><br/>"+message.msg).end().fadeIn();new_ctrl=$(ctrl.find('dd'));}else{ctrl=$('#skeleton').clone().appendTo($('#log')).addClass(message.chatterid).removeAttr('id').find('dd').html("<strong class='nameofuser "+nameclass+"'>"+ce.htmlspecialchars(message.fullname)+"</strong><br/>"+message.msg).end().fadeIn();new_ctrl=$(ctrl.find('dd'));messageDate=new Date(message.time*1000);min=(messageDate.getMinutes()<10)?"0"+messageDate.getMinutes():messageDate.getMinutes();ctrl.find('dt .msgtime').html(months[messageDate.getMonth()]+" "+messageDate.getDate()+"<br/>"+messageDate.getHours()+":"+min);}
$('dl:not(#skeleton):last img.usergravatar').attr('src',message.gravatar);}
return new_ctrl;};chat.register_keypress=function(ctrl)
{ctrl.keypress(function(e){if(e.which==13){if(chat.pressedenterfrom=="msgreply"){chat.pressedenterfrom="";}else{chat.sendtypedmessage(ctrl);}
e.preventDefault();}else{if(chat.timer_typing===null){chat.send_typing_info('start');}else{window.clearTimeout(chat.timer_typing);}
chat.timer_typing=window.setTimeout(function(){chat.timer_typing=null;chat.send_typing_info('stop');},1000);}});};chat.scrollintoview=function(setfocus)
{if(!setfocus)setfocus=false;if($('.ce-executiontime').length>0){if(chat.canscroll){$('.ce-executiontime').scrollintoview({complete:function(){chat.initialload=false;}});if(setfocus)$('#msgreply').eq(0).focus();}}else{if(chat.canscroll){$('#log .scrolltome').scrollintoview({complete:function(){chat.initialload=false;}});}}};chat.send_typing_info=function(type)
{$.ajax({url:"index.php?fuse=admin&controller=plugin&action=doplugin&pluginaction=typing&plugin=livevisitor",type:'POST',data:{id:chat.roomid,subtype:type,chatterid:chat.user.chatterid,user:chat.user.fullname,email:chat.user.email},success:$.noop});};chat.send_login_info=function()
{$.ajax({url:"index.php?fuse=admin&controller=plugin&action=doplugin&pluginaction=loggedin&plugin=livevisitor",type:'POST',data:{chatterid:chat.user.chatterid,ispublic:(typeof(chat.roomispublic)=="undefined")?0:chat.roomispublic,id:chat.roomid,userid:(typeof(clientexec)!="undefined"&&typeof(clientexec.admin_id)!="undefined")?clientexec.admin_id:0,title:(top.document.title=="")?"No Page Title":top.document.title,user:chat.user.fullname,email:chat.user.email}});};chat.getuniqueid=function()
{var uniqueId=null;uniqueId=(new Date()).getTime();return(uniqueId++);};(function(f){var c={vertical:{x:false,y:true},horizontal:{x:true,y:false},both:{x:true,y:true},x:{x:true,y:false},y:{x:false,y:true}};var b={duration:"fast",direction:"both"};var e=/^(?:html)$/i;var g=function(k,j){j=j||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(k,null):k.currentStyle);var i=document.defaultView&&document.defaultView.getComputedStyle?true:false;var h={top:(parseFloat(i?j.borderTopWidth:f.css(k,"borderTopWidth"))||0),left:(parseFloat(i?j.borderLeftWidth:f.css(k,"borderLeftWidth"))||0),bottom:(parseFloat(i?j.borderBottomWidth:f.css(k,"borderBottomWidth"))||0),right:(parseFloat(i?j.borderRightWidth:f.css(k,"borderRightWidth"))||0)};return{top:h.top,left:h.left,bottom:h.bottom,right:h.right,vertical:h.top+h.bottom,horizontal:h.left+h.right}};var d=function(h){var j=f(window);var i=e.test(h[0].nodeName);return{border:i?{top:0,left:0,bottom:0,right:0}:g(h[0]),scroll:{top:(i?j:h).scrollTop(),left:(i?j:h).scrollLeft()},scrollbar:{right:i?0:h.innerWidth()-h[0].clientWidth,bottom:i?0:h.innerHeight()-h[0].clientHeight},rect:(function(){var k=h[0].getBoundingClientRect();return{top:i?0:k.top,left:i?0:k.left,bottom:i?h[0].clientHeight:k.bottom,right:i?h[0].clientWidth:k.right}})()}};f.fn.extend({scrollintoview:function(j){j=f.extend({},b,j);j.direction=c[typeof(j.direction)==="string"&&j.direction.toLowerCase()]||c.both;var n="";if(j.direction.x===true){n="horizontal"}if(j.direction.y===true){n=n?"both":"vertical"}var l=this.eq(0);var i=l.closest(":scrollable("+n+")");if(i.length>0){i=i.eq(0);var m={e:d(l),s:d(i)};var h={top:m.e.rect.top-(m.s.rect.top+m.s.border.top),bottom:m.s.rect.bottom-m.s.border.bottom-m.s.scrollbar.bottom-m.e.rect.bottom,left:m.e.rect.left-(m.s.rect.left+m.s.border.left),right:m.s.rect.right-m.s.border.right-m.s.scrollbar.right-m.e.rect.right};var k={};if(j.direction.y===true){if(h.top<0){k.scrollTop=m.s.scroll.top+h.top}else{if(h.top>0&&h.bottom<0){k.scrollTop=m.s.scroll.top+Math.min(h.top,-h.bottom)}}}if(j.direction.x===true){if(h.left<0){k.scrollLeft=m.s.scroll.left+h.left}else{if(h.left>0&&h.right<0){k.scrollLeft=m.s.scroll.left+Math.min(h.left,-h.right)}}}if(!f.isEmptyObject(k)){if(e.test(i[0].nodeName)){i=f("html,body")}i.animate(k,j.duration).eq(0).queue(function(o){f.isFunction(j.complete)&&j.complete.call(i[0]);o()})}else{f.isFunction(j.complete)&&j.complete.call(i[0])}}return this}});var a={auto:true,scroll:true,visible:false,hidden:false};f.extend(f.expr[":"],{scrollable:function(k,i,n,h){var m=c[typeof(n[3])==="string"&&n[3].toLowerCase()]||c.both;var l=(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(k,null):k.currentStyle);var o={x:a[l.overflowX.toLowerCase()]||false,y:a[l.overflowY.toLowerCase()]||false,isRoot:e.test(k.nodeName)};if(!o.x&&!o.y&&!o.isRoot){return false}var j={height:{scroll:k.scrollHeight,client:k.clientHeight},width:{scroll:k.scrollWidth,client:k.clientWidth},scrollableX:function(){return(o.x||o.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(o.y||o.isRoot)&&this.height.scroll>this.height.client}};return m.y&&j.scrollableY()||m.x&&j.scrollableX()}})})(jQuery);;chat=chat||{};chat.user=chat.user||{};chat.groupid=0;chat.path="plugins/dashboard/livevisitor/chat/";chat.registerwithserver=function(firstmessage,user_data)
{var chatid,chatfullname,chatemail,chatroomid;if(typeof(user_data)!="undefined"){chat.user.chatterid=user_data.chatid;chat.user.fullname=user_data.chatfullname;chat.user.email=user_data.chatemail;chat.user.gravatar=getAvatarUrl(message.email,80,chat.user.fullname);chat.roomid=user_data.chatroomid;}else{chat.user.chatterid=$.cookie('chatid');chat.user.fullname=$.cookie('chatfullname');chat.user.email=$.cookie('chatemail');chat.user.gravatar=getAvatarUrl(chat.user.email,80,chat.user.fullname);chat.roomid=$.cookie('chatroomid');}
chat.playsound=true;chat.eventserviceid=chat.getuniqueid();chat.set_defaults_for_new_room();chat.startMyEventService(0);chat.send_login_info();chat.register_keypress($('#msg'));if(typeof(firstmessage)!=="undefined"){chat.sendtypedmessage($('input').val(firstmessage),0);}};chat.check_if_user_should_be_logged_off=function(e)
{var cookieexists=true;if($.cookie('chatroomid')==null)
{cookieexists=false;}
if(!cookieexists){chat.handleroomstatusupdate();}else{chat.close_event_source();chat.startMyEventService(0);}};chat.handleroomstatusupdate=function()
{$.removeCookie("chatroomid");chat.close_event_source();$('span.typing_wrapper img').remove();$('.operator-status').text("Conversation Closed");chat.hellobar.open();$('#messageform fieldset').hide();$('.restartchatdiv').show();chat.close_room();};chat.reset_chatroom_cookie=function()
{var date=new Date();var minutes=6;var roomid=$.cookie('chatroomid');date.setTime(date.getTime()+(minutes*60*1000));$.removeCookie("chatroomid");$.cookie('chatroomid',roomid,{expires:date});};chat.post_sent_message=function()
{if(chat.roomispublic){chat.publicroom_reset_chatroom_cookie();}else{chat.reset_chatroom_cookie();}};chat.new_message_notification=function(data)
{document.getElementById('soundreceived').play();};chat.handle_typing_event=function(e)
{var data=$.parseJSON(e.data);if(chat.roomispublic){chat.publicroom_handle_typing_event(data);}else{$('span.typing_wrapper img').remove();$.each(data.users,function(index,obj){if(obj.subtype==="1"){$('<img>').attr('src',chat.path+'../assets/typing.png').appendTo('span.typing_wrapper');}});}};chat.remove_typing_image=function(chatterid)
{$('span.typing_wrapper img').remove();};chat.set_other_users_name=function(allusers)
{$.each(allusers.users,function(index,data){if(chat.roomispublic){}else{if(data.chatterid===chat.user.chatterid)return;if(data.user===null){$('.operator-status').text("Waiting for an operator to respond.");}else{$('.operator-status').text("Talking to "+data.user);}}});};function getAvatarUrl(email,size,name)
{if(!size)size=80;if(!name)name=email.substring(0,1);if(name.indexOf(' ')>1){text=name.split(' ');name=text[0].substring(0,1)+text[1].substring(0,1);}
var url="https://www.avatar.bio/avatar/"+email+"?bc=DAF1FF&tc=555555&t="+name+"&s="+size;return url;};var HelloBar=function(message,atts,version_id){var self=this,_url="http://www.hellobar.com",_tagline="The HelloBar - a little bar that gets noticed!",_ns="hellobar",_sessionBegin,_opts={},_defaultBarHeight=30,_defaultBarBorderSize=3,_shadowSize=5,_defaults={afterOpen:null,afterClose:null,onOpen:null,onClose:null,onReady:null,height:_defaultBarHeight,borderSize:_defaultBarBorderSize,showWait:0,hideAfter:-1,wiggleWait:15000,barColor:'#eb593c',shadow:true,textColor:'#ffffff',linkColor:'#80ccff',linkStyle:'button',forgetful:false,positioning:'sticky',transition:'bouncy',speed:500,closable:true,helloBarLogo:true,tabSide:'right',showTabInstantly:false,texture:''};var _show=true,_alreadyShown=false,_isOpen=self.isOpen=true,_els=['wrapper','container','content','shadow','logo','close','open','pusher'],_ids={},_atts={wrapper:{type:'DIV',style:'display:none;'},container:{type:'DIV'},content:{type:'DIV'},shadow:{type:'DIV'},close:{type:'A',href:"#close",text:"Close",onclick:function(){self.close();return false},onmouseover:function(){openCloseOver()},onmouseout:function(){openCloseOut()}},open:{type:'A',href:"#close",text:"Open",onclick:function(){self.open();return false},onmouseover:function(){openCloseOver()},onmouseout:function(){openCloseOut()}},pusher:{type:'DIV'}};var UA=navigator.userAgent.toLowerCase(),Browser={chrome:UA.match(/chrome/)?true:false,firefox:UA.match(/firefox/)?true:false,firefox2:UA.match(/firefox\/2/)?true:false,firefox30:UA.match(/firefox\/3\.[0-9]/)?true:false,firefox40:UA.match(/firefox\/4\.[0-9]/)?true:false,msie:UA.match(/msie/)?true:false,msie6:(UA.match(/msie 6/)&&!UA.match(/msie 7|8/))?true:false,msie7:UA.match(/msie 7/)?true:false,msie8:UA.match(/msie 8/)?true:false,chromeFrame:(UA.match(/msie/)&&UA.match(/chrome/))?true:false,opera:UA.match(/opera/)?true:false,safari:(UA.match(/safari/)&&!UA.match(/chrome/))?true:false};function build(){var elements={};for(var i=0;i<_els.length;i++){var el=_els[i],valid=true;if(_opts.closable===false){if(el=='close'||el=='open'){valid=false}}if(typeof(_opts.helloBarLogo)!='undefined'){if(_opts.helloBarLogo){if(el=='logo'){valid=true}}}if(valid===true){var element;for(var a in _atts[el]){var val=_atts[el][a];switch(a){case"type":element=document.createElement(val);break;case"text":element.appendChild(document.createTextNode(val));break;case"onclick":element.onclick=val;break;case"onmouseover":element.onmouseover=val;break;case"onmouseout":element.onmouseout=val;break;default:element.setAttribute(a,val);break}}element.id=_ids[el];elements[el]=element}}if(_show===false){elements.container.style.top=(0-(_opts.height+_opts.borderSize))+"px"}if(_opts.positioning=='fixed'||_opts.positioning=='sticky'){if(Browser.msie6){_opts.positioning='overlap';elements.pusher.style.display="none"}}switch(_opts.positioning){case'push':break;case'overlap':elements.wrapper.style.position="absolute";elements.wrapper.style.width="100%";elements.wrapper.style.top="0";elements.wrapper.style.left="0";elements.wrapper.style.zIndex="5000";break;case'fixed':elements.wrapper.style.position="fixed";elements.wrapper.style.width="100%";elements.wrapper.style.top="0";elements.wrapper.style.left="0";elements.wrapper.style.zIndex="5000";break;case'sticky':elements.wrapper.style.position="fixed";elements.wrapper.style.width="100%";elements.wrapper.style.top="0";elements.wrapper.style.left="0";elements.wrapper.style.zIndex="5000";break}elements.container.style.height=_opts.height+"px";elements.wrapper.style.height=_opts.height+"px";elements.pusher.style.height=_opts.height+"px";if(_opts.height<60){if(typeof(_opts.helloBarLogo)!='undefined'){if(_opts.helloBarLogo){elements.logo.style.marginTop='-11px';elements.logo.style.top='50%'}}if(elements.close){elements.close.style.marginTop='-10px';elements.close.style.top='50%'}}if(typeof(_opts.texture)!='undefined'){if(_opts.texture!==""){var containerClasses=elements.container.className.split(" ");containerClasses.push('texture');containerClasses.push(_opts.texture);elements.container.className=containerClasses.join(" ")}}if(typeof(_opts.tabRadius)!='undefined'){if(_opts.tabRadius!==""){var browsers=['borderRadius','mozBorderRadius','webkitBorderRadius','oBorderRadius','khtmlBorderRadius'];for(var k in browsers){if(typeof(document.body.style[browsers[k]])!=='undefined'){elements.open.style[browsers[k]]=_opts.tabRadius}}}}if(typeof(_opts.borderSize)!='undefined'){if(_opts.borderSize!==""){elements.container.style.borderBottomWidth=_opts.borderSize+'px';elements.shadow.style.bottom=(0-(_opts.borderSize+_shadowSize))+'px';if(elements.open){elements.open.style.borderWidth=_opts.borderSize+'px'}}}if(typeof(_opts.borderColor)!='undefined'){if(_opts.borderColor!==""){elements.container.style.borderBottomColor=_opts.borderColor;elements.open.style.borderColor=_opts.borderColor}}if(typeof(_opts.shadow)!='undefined'){if(!_opts.shadow){elements.shadow.style.display='none'}}if(typeof(_opts.barColor)!='undefined'){if(_opts.barColor!==""){brightnessCheck(_opts.barColor);elements.container.style.backgroundColor=_opts.barColor;if(elements.open){elements.open.style.backgroundColor=_opts.barColor}}}if(typeof(_opts.textColor)!='undefined'){if(_opts.textColor!==""){elements.container.style.color=_opts.textColor}}if(typeof(_opts.fontWeight)!='undefined'){if(_opts.fontWeight!==""){elements.container.style.fontWeight=_opts.fontWeight}}if(typeof(_opts.fontStyle)!='undefined'){if(_opts.fontStyle!==""){elements.container.style.fontStyle=_opts.fontStyle}}if(typeof(_opts.lineHeight)!='undefined'){if(_opts.lineHeight!==""){elements.container.style.lineHeight=_opts.lineHeight}}else{elements.container.style.lineHeight=_opts.height+"px"}if(typeof(_opts.fontSize)!='undefined'){if(_opts.fontSize!==""){elements.container.style.fontSize=_opts.fontSize}}if(typeof(_opts.fonts)!='undefined'){if(_opts.fonts!==""){elements.container.style.fontFamily=_opts.fonts}}if(typeof(_opts.googleFont)!='undefined'){if(_opts.googleFont!==""){if(typeof(WebFontConfig)=='undefined'){WebFontConfig={google:{families:[_opts.googleFont]}};(function(){var hb_wf=document.createElement('script');hb_wf.src=('https:'==document.location.protocol?'https':'http')+'://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';hb_wf.type='text/javascript';hb_wf.async='true';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(hb_wf,s)})()}elements.container.style.fontFamily=_opts.googleFont.split(':')[0].replace(/\+/g,' ')}}var wrapperClasses=elements.wrapper.className.split(" ");wrapperClasses.push(_ns+'-'+_opts.tabSide);wrapperClasses.push(_ns+'-'+_opts.imageStyle);if(_opts.linkStyle!='link'){wrapperClasses.push(_ns+'-'+_opts.linkStyle)}elements.wrapper.className=wrapperClasses.join(" ");elements.content.innerHTML=unescape(self.message.replace(/\+/g," "));elements.container.appendChild(elements.content);if(typeof(_opts.helloBarLogo)!='undefined'){if(_opts.helloBarLogo){elements.container.appendChild(elements.logo)}}if(typeof(elements.logo)!='undefined'){elements.logo.href=elements.logo.href+="?utm_source="+document.location.hostname+"&utm_medium=hellobar&utm_campaign=HBSolo"}if(_opts.closable===true){elements.container.appendChild(elements.close)}elements.container.appendChild(elements.shadow);elements.wrapper.appendChild(elements.container);if(_opts.closable===true){elements.wrapper.appendChild(elements.open)}document.body.children[0].parentNode.insertBefore(elements.wrapper,document.body.children[0]);if(_opts.positioning=='sticky'){document.body.children[0].parentNode.insertBefore(elements.pusher,document.body.children[0])}var links=document.getElementById('hellobar-container').getElementsByTagName('A');for(var l in links){var link=links[l],oldOnClick=null;if(typeof(oldOnClick)=='function'){oldOnClick()}if(link.id===""){if(typeof(_opts.linkColor)!='undefined'){if(_opts.linkColor!==""){link.style.color=_opts.linkColor}}link.onclick=function(){if(typeof(oldOnClick)=='function'){oldOnClick()}}}else if(link.id==_ns+'-logo'){link.onclick=function(){if(typeof(oldOnClick)=='function'){oldOnClick()}return false}}}}function getCookie(){var cookies=document.cookie.split("; ");for(var i=0;i<cookies.length;i++){var key=cookies[i].split('=')[0],val=cookies[i].split('=')[1];if(key==_ns+"_"+version_id+"_hide"){_show=val==1?false:true}if(key==_ns+"_"+version_id+"_shown"){_alreadyShown=val==1?true:false}}}function setCookie(cookiename,val,clearCookie){if(_opts.forgetful===true){return false}var expireOnSessionClose=false,date=new Date(),days=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Nov','Dec'],D=new Date(date.getTime()+(365*86400000));if(typeof(clearCookie)!='undefined'){if(clearCookie===true){D=new Date(date.getTime()-(1*86400000))}if(clearCookie=='this_session'){expireOnSessionClose=true}}var dateStr=days[D.getUTCDay()]+", "+D.getUTCDate()+" "+months[D.getUTCMonth()]+" "+D.getUTCFullYear()+" "+D.getUTCHours()+":"+D.getUTCMinutes()+":"+D.getUTCSeconds()+" UTC";if(expireOnSessionClose){document.cookie=cookiename+"="+val+"; path=/"}else{document.cookie=cookiename+"="+val+"; expires="+dateStr+"; path=/"}}function close(callback){if(_isOpen){setCookie(_ns+"_"+version_id+"_hide",1);setCookie(_ns+"_"+version_id+"_shown",0,'this_session');if(typeof(_opts.onClose)=='function'){_opts.onClose(self,_opts,"onClose")}showTab(hideBar(function(){if(typeof(_opts.afterClose)=='function'){_opts.afterClose(self,_opts,"afterClose")}if(typeof(callback)=='function'){callback(self,_opts,"afterClose")}}));_isOpen=self.isOpen=false}}function open(callback){if(!_isOpen){if(_opts.hideAfter<_opts.showWait){clearInterval(window._hellobar_wiggleWaitTimer);clearTimeout(window._hellobar_hideAfterTimer)}setCookie(_ns+"_"+version_id+"_hide",0,true);setCookie(_ns+"_"+version_id+"_shown",1,'this_session');if(typeof(_opts.onOpen)=='function'){_opts.onOpen(self,_opts,"onOpen")}hideTab(showBar(function(){if(typeof(_opts.afterOpen)=='function'){_opts.afterOpen(self,_opts,"afterOpen")}if(typeof(callback)=='function'){callback(self,_opts,"afterOpen")}}));_isOpen=self.isOpen=true}}function openCloseOver(){self.elements.open.style.backgroundColor=brightenAndReturnRGB(_opts.barColor)}function openCloseOut(){self.elements.open.style.backgroundColor=_opts.barColor}function wiggleMe(){var wiggles=3;return function(pos){return((-Math.cos(pos*Math.PI*((1+(2*wiggles))*pos))/2)+0.5)}}function wiggle(){var animator=new Animator({transition:wiggleMe(),duration:500}).addSubject(new NumericalStyleSubject(self.elements.open,'right',10,13));animator.play()}function startWiggling(){if(_opts.wiggleWait>0){window._hellobar_wiggleWaitTimer="";window._hellobar_wiggleWaitTimer=setInterval(function(){wiggle()},_opts.wiggleWait)}}function showTab(callback){var animator=new Animator({transition:Animator.tx[_opts.transition],duration:_opts.speed,onComplete:function(){if(typeof(callback)=='function'){callback()}}}).addSubject(new NumericalStyleSubject(self.elements.open,'top',-96,-50));animator.play()}function showTabInstantly(){self.elements.open.style.top='-50px'}function hideTab(callback){var animator=new Animator({transition:Animator.tx[_opts.transition],duration:_opts.speed,onComplete:function(){if(typeof(callback)=='function'){callback()}}}).addSubject(new NumericalStyleSubject(self.elements.open,'top',-50,-96));animator.play()}function showBar(callback){var animator=new Animator({transition:Animator.tx[_opts.transition],duration:_opts.speed,onComplete:function(){callback(self,_opts,"afterOpen")}}).addSubject(new NumericalStyleSubject(self.elements.wrapper,'height',0,(_opts.height+_opts.borderSize))).addSubject(new NumericalStyleSubject(self.elements.container,'top',(0-(_opts.height+_opts.borderSize+_shadowSize)),0));if(_opts.positioning=='sticky'){animator.addSubject(new NumericalStyleSubject(self.elements.pusher,'height',0,(_opts.height+_opts.borderSize)))}animator.play()}function hideBar(callback){var animator=new Animator({transition:Animator.tx.easeOut,duration:_opts.speed,onComplete:function(){callback(self,_opts,"afterClose")}}).addSubject(new NumericalStyleSubject(self.elements.wrapper,'height',(_opts.height+_opts.borderSize),0)).addSubject(new NumericalStyleSubject(self.elements.container,'top',0,(0-(_opts.height+_opts.borderSize+_shadowSize))));if(_opts.positioning=='sticky'){animator.addSubject(new NumericalStyleSubject(self.elements.pusher,'height',(_opts.height+_opts.borderSize),0))}animator.play()}function cleanHexColor(hex){if(!hex.match('^#')){hex='#'+hex}if(hex.length==4){return'#'+hex.substr(1,3)+hex.substr(1,3)}return hex}function hex2rgb(hex){return new RGBColor(hex)}function isRGB(color){if(color.match('^rgb')){return true}else{return false}}function cleanRGB(rgba){var parts=rgba.match(/((\d+)?\.?\d+)/g);return{r:parts[0],g:parts[1],b:parts[2]};}function darkImages(color){if(isRGB(color)){rgb=cleanRGB(color)}else{hex=cleanHexColor(color);rgb=hex2rgb(hex)}if(rgb){var result=((rgb.r*299)+(rgb.g*587)+(rgb.b*114))/1000;if(result>125){return true}else{return false}}}function brightnessCheck(color){if(darkImages(color)){_opts.imageStyle='dark-images'}else{_opts.imageStyle='light-images'}}function brightenAndReturnRGB(color){if(isRGB(color)){rgb=cleanRGB(color)}else{hex=cleanHexColor(color);rgb=hex2rgb(hex)}if(darkImages(color)){var boost=38;return"rgb("+Math.min(rgb.r+boost,255)+","+Math.min(rgb.g+boost,255)+","+Math.min(rgb.b+boost,255)+")"}else{var boost=(0-38);return"rgb("+Math.max(rgb.r+boost,0)+","+Math.max(rgb.g+boost,0)+","+Math.max(rgb.b+boost,0)+")"}var boost=38;return"rgb("+Math.min(rgb.r+boost,255)+","+Math.min(rgb.g+boost,255)+","+Math.min(rgb.b+boost,255)+")"}function generateTimestamp(){var timestamp=Math.floor(new Date().getTime()/1000);return timestamp}this.close=function(callback){close(callback);return false};this.open=function(callback){open(callback);clearTimeout(window._hellobar_wiggleWaitTimer);return false};function initialize(message,atts,version_id){self.message=message;if(document.getElementById('hellobar-wrapper')){document.getElementById('hellobar-wrapper').parentNode.removeChild(document.getElementById('hellobar-wrapper'))}if(document.getElementById('hellobar-pusher')){document.getElementById('hellobar-pusher').parentNode.removeChild(document.getElementById('hellobar-pusher'))}clearTimeout(window._hellobar_showWaitTimer);clearTimeout(window._hellobar_hideAfterTimer);clearTimeout(window._hellobar_wiggleWaitTimer);var currentCookieMatch=document.cookie.match(/hellobar_current\=([0-9]+)/);if(currentCookieMatch){var currentCookieId=currentCookieMatch[1];if(parseInt(currentCookieId,10)!=parseInt(version_id,10)){var oldCookies=document.cookie.match(/hellobar_([0-9]+)_(variation|hide|shown)/g);for(var cookie in oldCookies){var oldCookie=oldCookies[cookie];setCookie(oldCookie,0,true)}setCookie('hellobar_current',0,true)}}setCookie('hellobar_current',version_id);_sessionBegin=generateTimestamp();for(var i in _els){keyname=_els[i];_ids[keyname]=[_ns,keyname].join('-')}for(var k in _defaults){_opts[k]=_defaults[k]}if(typeof(atts)!='undefined'){for(var k in atts){_opts[k]=atts[k]}}if(typeof(_opts.hideDestination)!='undefined'){if(_opts.hideDestination==1&&document.location.href==_opts.destinationUrl){return false}}if(_opts.forgetful===false){getCookie()}else{startWiggling()}_opts.height=Math.max(_opts.height,_defaultBarHeight);if(_opts.height>_defaultBarHeight){_opts.texture=''}if(!document.getElementById(_ids.wrapper)){build();self.elements={};for(var i=0;i<_els.length;i++){var _slug=_els[i];self.elements[_slug]=document.getElementById(_ids[_slug])}document.getElementById(_ids.wrapper).hellobar=self;if(typeof(_opts.onReady)=='function'){_opts.onReady(self,_opts,"onReady")}}if(_show===true&&_alreadyShown===true){self.elements.wrapper.style.display="block";self.elements.container.style.top="0px";self.elements.wrapper.style.height=(_opts.height+_opts.borderSize)+"px";if(_opts.positioning=='sticky'){self.elements.pusher.style.height=(0-(_opts.height+_opts.borderSize))+"px"}}self.elements.wrapper.style.display="block";if(_show===true){if(self.elements.open){self.elements.open.style.top="-96px"}if(_alreadyShown!==true){if(_opts.showWait>0){if((_opts.showWait<_opts.hideAfter)||(_opts.hideAfter<0)){self.elements.container.style.top=(0-(_opts.height+_opts.borderSize+_shadowSize))+"px";self.elements.wrapper.style.height="0px";if(_opts.positioning=='sticky'){self.elements.pusher.style.height="0px"}if(_opts.showTabInstantly){showTabInstantly()}else{showTab()}_isOpen=self.isOpen=false}window._hellobar_showWaitTimer="";window._hellobar_showWaitTimer=setTimeout(function(){open()},_opts.showWait)}else{open()}}if(_opts.hideAfter>0){_opts.hideAfter=_opts.hideAfter+_opts.showWait;window._hellobar_hideAfterTimer="";window._hellobar_hideAfterTimer=setTimeout(function(){close()},_opts.hideAfter)}}else{self.elements.container.style.top=(0-(_opts.height+_opts.borderSize+_shadowSize))+"px";self.elements.wrapper.style.height="0px";if(_opts.positioning=='sticky'){self.elements.pusher.style.height="0px"}showTab();_isOpen=self.isOpen=false;startWiggling()}}initialize(message,atts,version_id)};function Animator(a){this.setOptions(a);var b=this;this.timerDelegate=function(){b.onTimerEvent()};this.subjects=[];this.state=this.target=0;this.lastTime=null}Animator.prototype={setOptions:function(a){this.options=Animator.applyDefaults({interval:20,duration:400,onComplete:function(){},onStep:function(){},transition:Animator.tx.easeInOut},a)},seekTo:function(a){this.seekFromTo(this.state,a)},seekFromTo:function(a,b){this.target=Math.max(0,Math.min(1,b));this.state=Math.max(0,Math.min(1,a));this.lastTime=(new Date).getTime();if(!this.intervalId)this.intervalId=window.setInterval(this.timerDelegate,this.options.interval)},jumpTo:function(a){this.target=this.state=Math.max(0,Math.min(1,a));this.propagate()},toggle:function(){this.seekTo(1-this.target)},addSubject:function(a){this.subjects[this.subjects.length]=a;return this},clearSubjects:function(){this.subjects=[]},propagate:function(){for(var a=this.options.transition(this.state),b=0;b<this.subjects.length;b++)if(this.subjects[b].setState)this.subjects[b].setState(a);else this.subjects[b](a)},onTimerEvent:function(){var a=(new Date).getTime(),b=a-this.lastTime;this.lastTime=a;a=b/this.options.duration*(this.state<this.target?1:-1);Math.abs(a)>=Math.abs(this.state-this.target)?this.state=this.target:this.state+=a;try{this.propagate()}finally{this.options.onStep.call(this),this.target==this.state&&this.stop()}},stop:function(){if(this.intervalId)window.clearInterval(this.intervalId),this.intervalId=null,this.options.onComplete.call(this)},play:function(){this.seekFromTo(0,1)},reverse:function(){this.seekFromTo(1,0)},inspect:function(){for(var a="#<Animator:\n",b=0;b<this.subjects.length;b++)a+=this.subjects[b].inspect();a+=">";return a}};Animator.applyDefaults=function(a,b){var b=b||{},c,d={};for(c in a)d[c]=b[c]!==void 0?b[c]:a[c];return d};Animator.makeArrayOfElements=function(a){if(a==null)return[];if("string"==typeof a)return[document.getElementById(a)];if(!a.length)return[a];for(var b=[],c=0;c<a.length;c++)b[c]="string"==typeof a[c]?document.getElementById(a[c]):a[c];return b};Animator.camelize=function(a){var b=a.split("-");if(b.length==1)return b[0];for(var a=a.indexOf("-")==0?b[0].charAt(0).toUpperCase()+b[0].substring(1):b[0],c=1,d=b.length;c<d;c++){var e=b[c];a+=e.charAt(0).toUpperCase()+e.substring(1)}return a};Animator.apply=function(a,b,c){if(b instanceof Array)return(new Animator(c)).addSubject(new CSSStyleSubject(a,b[0],b[1]));return(new Animator(c)).addSubject(new CSSStyleSubject(a,b))};Animator.makeEaseIn=function(a){return function(b){return Math.pow(b,a*2)}};Animator.makeEaseOut=function(a){return function(b){return 1-Math.pow(1-b,a*2)}};Animator.makeElastic=function(a){return function(b){b=Animator.tx.easeInOut(b);return(1-Math.cos(b*Math.PI*a))*(1-b)+b}};Animator.makeADSR=function(a,b,c,d){d==null&&(d=0.5);return function(e){if(e<a)return e/a;if(e<b)return 1-(e-a)/(b-a)*(1-d);if(e<c)return d;return d*(1-(e-c)/(1-c))}};Animator.makeBounce=function(a){var b=Animator.makeElastic(a);return function(a){a=b(a);return a<=1?a:2-a}};Animator.tx={easeInOut:function(a){return-Math.cos(a*Math.PI)/2+0.5},linear:function(a){return a},easeIn:Animator.makeEaseIn(1.5),easeOut:Animator.makeEaseOut(1.5),strongEaseIn:Animator.makeEaseIn(2.5),strongEaseOut:Animator.makeEaseOut(2.5),elastic:Animator.makeElastic(1),veryElastic:Animator.makeElastic(3),bouncy:Animator.makeBounce(1),veryBouncy:Animator.makeBounce(3)};function NumericalStyleSubject(a,b,c,d,e){this.els=Animator.makeArrayOfElements(a);this.property=b=="opacity"&&window.ActiveXObject?"filter":Animator.camelize(b);this.from=parseFloat(c);this.to=parseFloat(d);this.units=e!=null?e:"px"}NumericalStyleSubject.prototype={setState:function(a){for(var a=this.getStyle(a),b=0,c=0;c<this.els.length;c++){try{this.els[c].style[this.property]=a}catch(d){if(this.property!="fontWeight")throw d;}if(b++>20)break}},getStyle:function(a){a=this.from+(this.to-this.from)*a;if(this.property=="filter")return"alpha(opacity="+Math.round(a*100)+")";if(this.property=="opacity")return a;return Math.round(a)+this.units},inspect:function(){return"\t"+this.property+"("+this.from+this.units+" to "+this.to+this.units+")\n"}};function ColorStyleSubject(a,b,c,d){this.els=Animator.makeArrayOfElements(a);this.property=Animator.camelize(b);this.to=this.expandColor(d);this.from=this.expandColor(c);this.origFrom=c;this.origTo=d}ColorStyleSubject.prototype={expandColor:function(a){var b,c;if(b=ColorStyleSubject.parseColor(a))return a=parseInt(b.slice(1,3),16),c=parseInt(b.slice(3,5),16),b=parseInt(b.slice(5,7),16),[a,c,b];window.ANIMATOR_DEBUG&&alert("Invalid colour: '"+a+"'")},getValueForState:function(a,b){return Math.round(this.from[a]+(this.to[a]-this.from[a])*b)},setState:function(a){for(var a="#"+ColorStyleSubject.toColorPart(this.getValueForState(0,a))+ColorStyleSubject.toColorPart(this.getValueForState(1,a))+ColorStyleSubject.toColorPart(this.getValueForState(2,a)),b=0;b<this.els.length;b++)this.els[b].style[this.property]=a},inspect:function(){return"\t"+this.property+"("+this.origFrom+" to "+this.origTo+")\n"}};ColorStyleSubject.parseColor=function(a){var b="#",c;if(c=ColorStyleSubject.parseColor.rgbRe.exec(a)){for(var d=1;d<=3;d++)a=Math.max(0,Math.min(255,parseInt(c[d]))),b+=ColorStyleSubject.toColorPart(a);return b}if(c=ColorStyleSubject.parseColor.hexRe.exec(a)){if(c[1].length==3){for(d=0;d<3;d++)b+=c[1].charAt(d)+c[1].charAt(d);return b}return"#"+c[1]}return!1};ColorStyleSubject.toColorPart=function(a){a>255&&(a=255);var b=a.toString(16);if(a<16)return"0"+b;return b};ColorStyleSubject.parseColor.rgbRe=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i;ColorStyleSubject.parseColor.hexRe=/^\#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/;function DiscreteStyleSubject(a,b,c,d,e){this.els=Animator.makeArrayOfElements(a);this.property=Animator.camelize(b);this.from=c;this.to=d;this.threshold=e||0.5}DiscreteStyleSubject.prototype={setState:function(a){for(var b=0;b<this.els.length;b++)this.els[b].style[this.property]=a<=this.threshold?this.from:this.to},inspect:function(){return"\t"+this.property+"("+this.from+" to "+this.to+" @ "+this.threshold+")\n"}};function CSSStyleSubject(a,b,c){a=Animator.makeArrayOfElements(a);this.subjects=[];if(a.length!=0){var d;if(c)b=this.parseStyle(b,a[0]),c=this.parseStyle(c,a[0]);else for(d in c=this.parseStyle(b,a[0]),b={},c)b[d]=CSSStyleSubject.getStyle(a[0],d);for(d in b)b[d]==c[d]&&(delete b[d],delete c[d]);var e,f,h,j;for(d in b){var i=String(b[d]),g=String(c[d]);if(c[d]==null)window.ANIMATOR_DEBUG&&alert("No to style provided for '"+d+'"');else{if(h=ColorStyleSubject.parseColor(i))j=ColorStyleSubject.parseColor(g),f=ColorStyleSubject;else if(i.match(CSSStyleSubject.numericalRe)&&g.match(CSSStyleSubject.numericalRe))h=parseFloat(i),j=parseFloat(g),f=NumericalStyleSubject,e=CSSStyleSubject.numericalRe.exec(i),g=CSSStyleSubject.numericalRe.exec(g),e=e[1]!=null?e[1]:g[1]!=null?g[1]:g;else if(i.match(CSSStyleSubject.discreteRe)&&g.match(CSSStyleSubject.discreteRe))h=i,j=g,f=DiscreteStyleSubject,e=0;else{window.ANIMATOR_DEBUG&&alert("Unrecognised format for value of "+d+": '"+b[d]+"'");continue}this.subjects[this.subjects.length]=new f(a,d,h,j,e)}}}}CSSStyleSubject.prototype={parseStyle:function(a,b){var c={};if(a.indexOf(":")!=-1)for(var d=a.split(";"),e=0;e<d.length;e++){var f=CSSStyleSubject.ruleRe.exec(d[e]);f&&(c[f[1]]=f[2])}else{var h;h=b.className;b.className=a;for(e=0;e<CSSStyleSubject.cssProperties.length;e++)d=CSSStyleSubject.cssProperties[e],f=CSSStyleSubject.getStyle(b,d),f!=null&&(c[d]=f);b.className=h}return c},setState:function(a){for(var b=0;b<this.subjects.length;b++)this.subjects[b].setState(a)},inspect:function(){for(var a="",b=0;b<this.subjects.length;b++)a+=this.subjects[b].inspect();return a}};CSSStyleSubject.getStyle=function(a,b){var c;if(document.defaultView&&document.defaultView.getComputedStyle&&(c=document.defaultView.getComputedStyle(a,"").getPropertyValue(b)))return c;b=Animator.camelize(b);a.currentStyle&&(c=a.currentStyle[b]);return c||a.style[b]};CSSStyleSubject.ruleRe=/^\s*([a-zA-Z\-]+)\s*:\s*(\S(.+\S)?)\s*$/;CSSStyleSubject.numericalRe=/^-?\d+(?:\.\d+)?(%|[a-zA-Z]{2})?$/;CSSStyleSubject.discreteRe=/^\w+$/;CSSStyleSubject.cssProperties=["azimuth","background","background-attachment","background-color","background-image","background-position","background-repeat","border-collapse","border-color","border-spacing","border-style","border-top","border-top-color","border-right-color","border-bottom-color","border-left-color","border-top-style","border-right-style","border-bottom-style","border-left-style","border-top-width","border-right-width","border-bottom-width","border-left-width","border-width","bottom","clear","clip","color","content","cursor","direction","display","elevation","empty-cells","css-float","font","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","height","left","letter-spacing","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-top","margin-right","margin-bottom","margin-left","max-height","max-width","min-height","min-width","orphans","outline","outline-color","outline-style","outline-width","overflow","padding","padding-top","padding-right","padding-bottom","padding-left","pause","position","right","size","table-layout","text-align","text-decoration","text-indent","text-shadow","text-transform","top","vertical-align","visibility","white-space","width","word-spacing","z-index","opacity","outline-offset","overflow-x","overflow-y"];function AnimatorChain(a,b){this.animators=a;this.setOptions(b);for(var c=0;c<this.animators.length;c++)this.listenTo(this.animators[c]);this.forwards=!1;this.current=0}AnimatorChain.prototype={setOptions:function(a){this.options=Animator.applyDefaults({resetOnPlay:!0},a)},play:function(){this.forwards=!0;this.current=-1;if(this.options.resetOnPlay)for(var a=0;a<this.animators.length;a++)this.animators[a].jumpTo(0);this.advance()},reverse:function(){this.forwards=!1;this.current=this.animators.length;if(this.options.resetOnPlay)for(var a=0;a<this.animators.length;a++)this.animators[a].jumpTo(1);this.advance()},toggle:function(){this.forwards?this.seekTo(0):this.seekTo(1)},listenTo:function(a){var b=a.options.onComplete,c=this;a.options.onComplete=function(){b&&b.call(a);c.advance()}},advance:function(){this.forwards?this.animators[this.current+1]!=null&&(this.current++,this.animators[this.current].play()):this.animators[this.current-1]!=null&&(this.current--,this.animators[this.current].reverse())},seekTo:function(a){a<=0?(this.forwards=!1,this.animators[this.current].seekTo(0)):(this.forwards=!0,this.animators[this.current].seekTo(1))}};function RGBColor(color_string){this.ok=false;if(color_string.charAt(0)=='#'){color_string=color_string.substr(1,6)}color_string=color_string.replace(/ /g,'');color_string=color_string.toLowerCase();var simple_colors={aliceblue:'f0f8ff',antiquewhite:'faebd7',aqua:'00ffff',aquamarine:'7fffd4',azure:'f0ffff',beige:'f5f5dc',bisque:'ffe4c4',black:'000000',blanchedalmond:'ffebcd',blue:'0000ff',blueviolet:'8a2be2',brown:'a52a2a',burlywood:'deb887',cadetblue:'5f9ea0',chartreuse:'7fff00',chocolate:'d2691e',coral:'ff7f50',cornflowerblue:'6495ed',cornsilk:'fff8dc',crimson:'dc143c',cyan:'00ffff',darkblue:'00008b',darkcyan:'008b8b',darkgoldenrod:'b8860b',darkgray:'a9a9a9',darkgreen:'006400',darkkhaki:'bdb76b',darkmagenta:'8b008b',darkolivegreen:'556b2f',darkorange:'ff8c00',darkorchid:'9932cc',darkred:'8b0000',darksalmon:'e9967a',darkseagreen:'8fbc8f',darkslateblue:'483d8b',darkslategray:'2f4f4f',darkturquoise:'00ced1',darkviolet:'9400d3',deeppink:'ff1493',deepskyblue:'00bfff',dimgray:'696969',dodgerblue:'1e90ff',feldspar:'d19275',firebrick:'b22222',floralwhite:'fffaf0',forestgreen:'228b22',fuchsia:'ff00ff',gainsboro:'dcdcdc',ghostwhite:'f8f8ff',gold:'ffd700',goldenrod:'daa520',gray:'808080',green:'008000',greenyellow:'adff2f',honeydew:'f0fff0',hotpink:'ff69b4',indianred:'cd5c5c',indigo:'4b0082',ivory:'fffff0',khaki:'f0e68c',lavender:'e6e6fa',lavenderblush:'fff0f5',lawngreen:'7cfc00',lemonchiffon:'fffacd',lightblue:'add8e6',lightcoral:'f08080',lightcyan:'e0ffff',lightgoldenrodyellow:'fafad2',lightgrey:'d3d3d3',lightgreen:'90ee90',lightpink:'ffb6c1',lightsalmon:'ffa07a',lightseagreen:'20b2aa',lightskyblue:'87cefa',lightslateblue:'8470ff',lightslategray:'778899',lightsteelblue:'b0c4de',lightyellow:'ffffe0',lime:'00ff00',limegreen:'32cd32',linen:'faf0e6',magenta:'ff00ff',maroon:'800000',mediumaquamarine:'66cdaa',mediumblue:'0000cd',mediumorchid:'ba55d3',mediumpurple:'9370d8',mediumseagreen:'3cb371',mediumslateblue:'7b68ee',mediumspringgreen:'00fa9a',mediumturquoise:'48d1cc',mediumvioletred:'c71585',midnightblue:'191970',mintcream:'f5fffa',mistyrose:'ffe4e1',moccasin:'ffe4b5',navajowhite:'ffdead',navy:'000080',oldlace:'fdf5e6',olive:'808000',olivedrab:'6b8e23',orange:'ffa500',orangered:'ff4500',orchid:'da70d6',palegoldenrod:'eee8aa',palegreen:'98fb98',paleturquoise:'afeeee',palevioletred:'d87093',papayawhip:'ffefd5',peachpuff:'ffdab9',peru:'cd853f',pink:'ffc0cb',plum:'dda0dd',powderblue:'b0e0e6',purple:'800080',red:'ff0000',rosybrown:'bc8f8f',royalblue:'4169e1',saddlebrown:'8b4513',salmon:'fa8072',sandybrown:'f4a460',seagreen:'2e8b57',seashell:'fff5ee',sienna:'a0522d',silver:'c0c0c0',skyblue:'87ceeb',slateblue:'6a5acd',slategray:'708090',snow:'fffafa',springgreen:'00ff7f',steelblue:'4682b4',tan:'d2b48c',teal:'008080',thistle:'d8bfd8',tomato:'ff6347',turquoise:'40e0d0',violet:'ee82ee',violetred:'d02090',wheat:'f5deb3',white:'ffffff',whitesmoke:'f5f5f5',yellow:'ffff00',yellowgreen:'9acd32'};for(var key in simple_colors){if(color_string==key){color_string=simple_colors[key]}}var color_defs=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:['rgb(123, 234, 45)','rgb(255,234,245)'],process:function(bits){return[parseInt(bits[1]),parseInt(bits[2]),parseInt(bits[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:['#00ff00','336699'],process:function(bits){return[parseInt(bits[1],16),parseInt(bits[2],16),parseInt(bits[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:['#fb0','f0f'],process:function(bits){return[parseInt(bits[1]+bits[1],16),parseInt(bits[2]+bits[2],16),parseInt(bits[3]+bits[3],16)]}}];for(var i=0;i<color_defs.length;i++){var re=color_defs[i].re,processor=color_defs[i].process,bits=re.exec(color_string);if(bits){channels=processor(bits);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return'rgb('+this.r+', '+this.g+', '+this.b+')'};this.toHex=function(){var r=this.r.toString(16),g=this.g.toString(16),b=this.b.toString(16);if(r.length==1)r='0'+r;if(g.length==1)g='0'+g;if(b.length==1)b='0'+b;return'#'+r+g+b};this.getHelpXML=function(){var examples=new Array();for(var i=0;i<color_defs.length;i++){var example=color_defs[i].example;for(var j=0;j<example.length;j++){examples[examples.length]=example[j]}}for(var sc in simple_colors){examples[examples.length]=sc}var xml=document.createElement('ul');xml.setAttribute('id','rgbcolor-examples');for(var i=0;i<examples.length;i++){try{var list_item=document.createElement('li'),list_color=new RGBColor(examples[i]),example_div=document.createElement('div');example_div.style.cssText='margin: 3px; border: 1px solid black; background:'+list_color.toHex()+'; color:'+list_color.toHex();example_div.appendChild(document.createTextNode('test'));var list_item_value=document.createTextNode(' '+examples[i]+' -> '+list_color.toRGB()+' -> '+list_color.toHex());list_item.appendChild(example_div);list_item.appendChild(list_item_value);xml.appendChild(list_item)}catch(e){}}return xml};}